jade.templates = jade.templates || {};
jade.templates['dnaBarcodeShortInput'] = (function(){
  return function template(locals) {
var buf = [];
var jade_mixins = {};
var jade_interp;
;var locals_for_with = (locals || {});(function (idx) {
buf.push("<div" + (jade.attr("id", 'fg-dtmbh-' + (idx) + '', true, false)) + " class=\"form-group\"><label" + (jade.attr("for", 'ff-dtmbh-' + (idx) + '', true, false)) + " class=\"col-xs-3 control-label no-padding-right\">条码编号</label><div class=\"col-xs-9\"><input" + (jade.attr("id", 'ff-dtmbh-' + (idx) + '', true, false)) + " type=\"text\" name=\"barcode_long\" placeholder=\"请扫描短采血管条码或录入条码编号\" class=\"my-dtmbh col-xs-6\"/><span class=\"help-inline col-xs-6\"><button" + (jade.attr("id", 'btn-dtm-del-id-' + (idx) + '', true, false)) + " type=\"button\" class=\"btn btn-xs btn-danger\"><i class=\"icon-trash\">删除</i></button><span" + (jade.attr("id", 'help-dtm-id-' + (idx) + '', true, false)) + " class=\"middle\">Inline help text</span></span></div><script>$('#btn-dtm-del-id-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').hide();\n$('#help-dtm-id-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').hide();\nvar itvl" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + " = setInterval(function () {\n    $('#ff-dtmbh-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').focus();\n}, 200);\n\n$('#ff-dtmbh-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').change(function () {\n    var self = $(this);\n    var barcode_long = self.val();\n    var dtmArray = $('.my-dtmbh').map(function (i, v) {\n        var vv = $(v).val();\n        if (vv)return vv;\n    }).get();\n    var sameCount = 0;\n    for (var i = dtmArray.length - 1; i >= 0; i--) {\n        var dtm = dtmArray[i];\n        if (dtm === barcode_long) {\n            ++sameCount;\n            if (sameCount >= 2) {\n                Toast.show('一次不能出库两个一样条码的试管:' + barcode_long);\n                self.val('');\n                return;\n            }\n        }\n    }\n    clearInterval(itvl" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + ");\n    $('#btn-dtm-del-id-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').show();\n    $('#ff-dtmbh-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').attr('readonly', true);\n\n    $.post('dna/receive/getByBarcodeShort', {\n        barcode_long: barcode_long\n    }, function (rows) {\n        if (rows && rows.length == 1) {\n            var row = rows[0];\n            var count = row.sample_out_residue;\n            if (row.status == 3 /*已审批且入库*/ || row.status == 8/*重提取*/) { //已审批\n                if (count == 0) {\n                    Toast.show('可能此条码的试管已经全部出库了:' + barcode_long);\n                    $('#fg-dtmbh-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').slideUp(800, function () {\n                        $(this).remove();\n                    });\n                } else if (count > 0) {\n                    $('#help-dtm-id-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').text('剩余数量:' + (count - 1)).show();\n                }\n            } else {\n                Toast.show('此条码的试管福满足出库条件,不能出库:' + barcode_long);\n                $('#fg-dtmbh-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').slideUp(800, function () {\n                    $(this).remove();\n                });\n            }\n        } else {\n            Toast.show('数据库中不存在此短条码:' + barcode_long);\n            $('#fg-dtmbh-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').slideUp(800, function () {\n                $(this).remove();\n            });\n        }\n    });\n    myNext();\n});\n$('#btn-dtm-del-id-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').click(function (e) {\n    e.stopPropagation();\n    e.preventDefault();\n    clearInterval(itvl" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + ");\n    $('#fg-dtmbh-" + (jade.escape((jade_interp = idx) == null ? '' : jade_interp)) + "').slideUp(800, function () {\n        $(this).remove();\n    });\n    return false;\n});</script></div>");}.call(this,"idx" in locals_for_with?locals_for_with.idx:typeof idx!=="undefined"?idx:undefined));;return buf.join("");
};
})();